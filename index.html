<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator kodów kreskowych</title>
    <meta name="theme-color" content="#16161A"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Generator Kodów">
    
    <!-- Importowanie bibliotek -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        :root {
            --primary: #7F5AF0;
            --primary-dark: #6B47D6;
            --background: #16161A;
            --secondary: #242629;
            --text: #FFFFFE;
            --paragraph: #94A1B2;
            --success: #2CB67D;
            --error: #FF5470;
            --gradient-start: #7F5AF0;
            --gradient-end: #FF8E3C;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, var(--background) 0%, #1a1b26 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: max(2rem, env(safe-area-inset-top)) 2rem max(2rem, env(safe-area-inset-bottom));
        }

        /* Theme Switcher */
        .theme-switch {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(36, 38, 41, 0.8);
            border: none;
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .theme-switch:hover {
            transform: scale(1.1);
        }

        /* Container Styles */
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: rgba(36, 38, 41, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            margin-top: 2rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab.active {
            background: var(--primary);
        }

        .tab:hover:not(.active) {
            background: rgba(127, 90, 240, 0.1);
        }

        /* Input Groups */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-label span {
            font-size: 0.875rem;
            color: var(--paragraph);
        }

        input, select {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(127, 90, 240, 0.2);
        }

        /* Advanced Settings */
        .advanced-settings {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .color-picker input[type="color"] {
            width: 50px;
            height: 50px;
            padding: 0;
            border: none;
            border-radius: 0.25rem;
        }

        /* Buttons */
        .button {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        .button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Barcode Display */
        .barcode-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            margin-top: 2rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .barcode-container svg {
            max-width: 100%;
            height: auto;
        }

        .barcode-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .barcode-container:hover .barcode-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .action-button {
            background: var(--secondary);
            color: var(--text);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            background: rgba(36, 38, 41, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.error {
            background: var(--error);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .barcode-actions {
                opacity: 1;
                transform: none;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dark Mode */
        .dark {
            --background: #1F2937;
            --secondary: #374151;
            --text: #F9FAFB;
            --paragraph: #D1D5DB;
        }

        .dark .container {
            background: rgba(31, 41, 55, 0.8);
        }

        .dark input,
        .dark select,
        .dark .button.secondary {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark .barcode-container {
            background: #374151;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <button class="theme-switch" id="theme-switch" aria-label="Przełącz motyw">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2"/>
            <path d="M12 21v2"/>
            <path d="M4.22 4.22l1.42 1.42"/>
            <path d="M18.36 18.36l1.42 1.42"/>
            <path d="M1 12h2"/>
            <path d="M21 12h2"/>
            <path d="M4.22 19.78l1.42-1.42"/>
            <path d="M18.36 5.64l1.42-1.42"/>
        </svg>
    </button>

    <div class="container">
        <div class="tabs" role="tablist">
            <button class="tab active" data-tab="barcode" role="tab">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 2v20M8 2v20M12 2v20M16 2v20M20 2v20"/>
                </svg>
                Kod kreskowy
            </button>
            <button class="tab" data-tab="qr" role="tab">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M7 7h.01M17 7h.01M7 17h.01M17 17h.01"/>
                </svg>
                Kod QR
            </button>
            <button class="tab" data-tab="batch" role="tab">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6"/>
                    <path d="M16 13H8"/>
                    <path d="M16 17H8"/>
                    <path d="M10 9H8"/>
                </svg>
                Z pliku CSV
            </button>
        </div>

        <div class="tab-content active" data-tab-content="barcode">
            <div class="input-group">
                <label class="input-label">
                    <span>Tekst do zakodowania</span>
                    <input type="text" id="barcode-text" placeholder="Wprowadź tekst" />
                </label>

                <label class="input-label">
                    <span>Format kodu</span>
                    <select id="barcode-format">
                        <option value="CODE128">CODE128 (domyślny)</option>
                        <option value="EAN13">EAN13 (13 cyfr)</option>
                        <option value="EAN8">EAN8 (8 cyfr)</option>
                        <option value="UPC">UPC (12 cyfr)</option>
                        <option value="CODE39">CODE39</option>
                    </select>
                </label>

                <div class="advanced-settings">
                    <button class="button secondary" id="toggle-advanced">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 01.82H17" />
                        <path d="M2 12.88V9.12A2 2 0 0 1 4.12 7h0a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V17"/>
                    </svg>
                    Zaawansowane opcje
                </button>

                <div class="settings-grid" id="advanced-settings" style="display: none;">
                    <label class="input-label">
                        <span>Szerokość linii</span>
                        <input type="range" id="line-width" min="1" max="4" step="0.5" value="2" />
                    </label>

                    <label class="input-label">
                        <span>Wysokość kodu</span>
                        <input type="range" id="barcode-height" min="50" max="200" step="10" value="100" />
                    </label>

                    <div class="color-picker">
                        <label class="input-label">
                            <span>Kolor kodu</span>
                            <input type="color" id="line-color" value="#000000" />
                        </label>
                    </div>

                    <div class="color-picker">
                        <label class="input-label">
                            <span>Kolor tła</span>
                            <input type="color" id="background-color" value="#FFFFFF" />
                        </label>
                    </div>

                    <label class="input-label">
                        <span>Własny tekst</span>
                        <input type="text" id="custom-text" placeholder="Dodatkowy tekst pod kodem" />
                    </label>

                    <label class="input-label">
                        <span>Rozmiar tekstu</span>
                        <input type="range" id="font-size" min="8" max="24" step="1" value="14" />
                    </label>
                </div>
            </div>

            <button class="button" id="generate-barcode">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 2v20M8 2v20M12 2v20M16 2v20M20 2v20"/>
                </svg>
                Generuj kod kreskowy
            </button>

            <div class="barcode-container" id="barcode-container" style="display: none;">
                <svg id="barcode"></svg>
                
                <div class="barcode-actions">
                    <button class="action-button" id="download-svg" title="Pobierz SVG">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                    
                    <button class="action-button" id="copy-svg" title="Kopiuj do schowka">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </button>
                    
                    <button class="action-button" id="fullscreen" title="Tryb pełnoekranowy">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="tab-content" data-tab-content="qr" style="display: none;">
            <div class="input-group">
                <label class="input-label">
                    <span>Tekst do zakodowania</span>
                    <input type="text" id="qr-text" placeholder="Wprowadź tekst dla kodu QR" />
                </label>

                <label class="input-label">
                    <span>Poziom korekcji błędów</span>
                    <select id="qr-error-level">
                        <option value="L">Niski (7%)</option>
                        <option value="M">Średni (15%)</option>
                        <option value="Q">Wysoki (25%)</option>
                        <option value="H">Najwyższy (30%)</option>
                    </select>
                </label>

                <div class="color-picker">
                    <label class="input-label">
                        <span>Kolor kodu QR</span>
                        <input type="color" id="qr-color" value="#000000" />
                    </label>
                </div>
            </div>

            <button class="button" id="generate-qr">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M7 7h.01M17 7h.01M7 17h.01M17 17h.01"/>
                </svg>
                Generuj kod QR
            </button>

            <div id="qr-container" style="display: none;"></div>
        </div>

        <div class="tab-content" data-tab-content="batch" style="display: none;">
            <div class="input-group">
                <label class="input-label">
                    <span>Plik CSV</span>
                    <input type="file" id="csv-file" accept=".csv" />
                </label>

                <div class="file-info">
                    <p class="text-sm text-gray-400">
                        Plik CSV powinien zawierać kolumny: "code" (tekst do zakodowania) i opcjonalnie "format" (format kodu).
                    </p>
                </div>
            </div>

            <button class="button" id="generate-batch">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6"/>
                    <path d="M16 13H8"/>
                    <path d="M16 17H8"/>
                    <path d="M10 9H8"/>
                </svg>
                Generuj serię kodów
            </button>

            <div id="batch-container" class="grid gap-4 mt-4"></div>
        </div>
    </div>

    <div class="notification" id="notification">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span id="notification-text">Powiadomienie</span>
    </div>

    <script>
        // Obsługa motywu ciemnego/jasnego
        const themeSwitch = document.getElementById('theme-switch');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        function setTheme(theme) {
            document.body.className = theme;
            localStorage.setItem('theme', theme);
        }

        // Inicjalizacja motywu
        const savedTheme = localStorage.getItem('theme') || 
            (prefersDarkScheme.matches ? 'dark' : 'light');
        setTheme(savedTheme);

        themeSwitch.addEventListener('click', () => {
            const currentTheme = document.body.className;
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        // Obsługa zakładek
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // Aktywacja zakładki
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Pokazanie odpowiedniej zawartości
                tabContents.forEach(content => {
                    if (content.dataset.tabContent === tabId) {
                        content.style.display = 'block';
                    } else {
                        content.style.display = 'none';
                    }
                });
            });
        });

        // Obsługa zaawansowanych ustawień
        const toggleAdvanced = document.getElementById('toggle-advanced');
        const advancedSettings = document.getElementById('advanced-settings');

        toggleAdvanced.addEventListener('click', () => {
            const isHidden = advancedSettings.style.display === 'none';
            advancedSettings.style.display = isHidden ? 'grid' : 'none';
            toggleAdvanced.classList.toggle('active');
        });

        // Funkcja pokazywania powiadomień
        function showNotification(message, type = 'default') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Generowanie kodu kreskowego
        function generateBarcode() {
            const text = document.getElementById('barcode-text').value;
            const format = document.getElementById('barcode-format').value;
            const container = document.getElementById('barcode-container');
            
            if (!text) {
                showNotification('Wprowadź tekst!', 'error');
                return;
            }

            try {
                // Pobieranie zaawansowanych ustawień
                const lineWidth = document.getElementById('line-width').value;
                const height = document.getElementById('barcode-height').value;
                const lineColor = document.getElementById('line-color').value;
                const backgroundColor = document.getElementById('background-color').value;
                const fontSize = document.getElementById('font-size').value;
                const customText = document.getElementById('custom-text').value;

                // Generowanie kodu
                JsBarcode("#barcode", text, {
                    format: format,
                    width: parseFloat(lineWidth),
                    height: parseInt(height),
                    displayValue: true,
                    font: "-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif",
                    fontSize: parseInt(fontSize),
                    lineColor: lineColor,
                    background: backgroundColor,
                    margin: 10
                });

                // Dodawanie własnego tekstu
                if (customText) {
                    const svg = document.getElementById('barcode');
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", "50%");
                    text.setAttribute("y", svg.height.baseVal.value - 10);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("font-family", "-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif");
                    text.setAttribute("font-size", fontSize + "px");
                    text.setAttribute("fill", lineColor);
                    text.textContent = customText;
                    svg.appendChild(text);
                }

                container.style.display = 'block';
                showNotification('Kod został wygenerowany!', 'success');
                
                // Zapisanie do historii
                saveToHistory({
                    text,
                    format,
                    lineColor,
                    backgroundColor,
                    customText
                });
            } catch (e) {
                showNotification('Błąd generowania kodu: ' + e.message, 'error');
            }
        }

        // Obsługa historii
        function saveToHistory(data) {
            const history = JSON.parse(localStorage.getItem('barcodeHistory') || '[]');
            history.unshift({
                ...data,
                timestamp: new Date().toISOString()
            });
            
            // Zachowaj tylko ostatnie 10 kodów
            const limitedHistory = history.slice(0, 10);
            localStorage.setItem('barcodeHistory', JSON.stringify(limitedHistory));
        }

        // Pobieranie kodu jako SVG
        document.getElementById('download-svg').addEventListener('click', () => {
            const svg = document.getElementById('barcode');
            const svgData = new XMLSerializer().serializeToString(svg);
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            saveAs(blob, 'barcode.svg');
            showNotification('Kod został pobrany!', 'success');
        });

        // Kopiowanie do schowka
        document.getElementById('copy-svg').addEventListener('click', async () => {
            const svg = document.getElementById('barcode');
            const svgData = new XMLSerializer().serializeToString(svg);
            
            try {
                await navigator.clipboard.writeText(svgData);
                showNotification('Kod został skopiowany do schowka!', 'success');
            } catch (err) {
                showNotification('Nie udało się skopiować kodu', 'error');
            }
        });

        // Obsługa trybu pełnoekranowego
        document.getElementById('fullscreen').addEventListener('click', () => {
            const container = document.getElementById('barcode-container');
            if (document.fullscreenElement) {document.exitFullscreen();
            } else {
                container.requestFullscreen().catch(err => {
                    showNotification('Nie można przejść w tryb pełnoekranowy', 'error');
                });
            }
        });

        // Generowanie kodu QR
        function generateQRCode() {
            const text = document.getElementById('qr-text').value;
            const errorLevel = document.getElementById('qr-error-level').value;
            const color = document.getElementById('qr-color').value;
            const container = document.getElementById('qr-container');

            if (!text) {
                showNotification('Wprowadź tekst!', 'error');
                return;
            }

            container.innerHTML = '';
            container.style.display = 'block';

            try {
                new QRCode(container, {
                    text: text,
                    width: 256,
                    height: 256,
                    colorDark: color,
                    colorLight: "#ffffff",
                    correctLevel: QRCode[errorLevel]
                });

                showNotification('Kod QR został wygenerowany!', 'success');
            } catch (e) {
                showNotification('Błąd generowania kodu QR: ' + e.message, 'error');
            }
        }

        // Generowanie serii kodów z CSV
        async function generateBatchCodes() {
            const fileInput = document.getElementById('csv-file');
            const container = document.getElementById('batch-container');
            
            if (!fileInput.files.length) {
                showNotification('Wybierz plik CSV!', 'error');
                return;
            }

            try {
                const file = fileInput.files[0];
                const text = await file.text();
                const rows = text.split('\n').filter(row => row.trim());
                container.innerHTML = '';

                let successCount = 0;
                let errorCount = 0;

                for (let i = 1; i < rows.length; i++) { // Pomijamy nagłówek
                    const [code, format = 'CODE128'] = rows[i].split(',').map(s => s.trim());
                    
                    if (code) {
                        const barcodeDiv = document.createElement('div');
                        barcodeDiv.className = 'bg-white p-4 rounded-lg';
                        const svg = document.createElement('svg');
                        svg.id = `batch-barcode-${i}`;
                        barcodeDiv.appendChild(svg);
                        container.appendChild(barcodeDiv);

                        try {
                            JsBarcode(`#batch-barcode-${i}`, code, {
                                format: format,
                                width: 2,
                                height: 100,
                                displayValue: true,
                                font: "-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif",
                                margin: 10
                            });
                            successCount++;
                        } catch (e) {
                            errorCount++;
                            console.error(`Błąd dla kodu ${code}:`, e);
                            barcodeDiv.innerHTML = `<p class="text-error">Błąd generowania kodu: ${code}</p>`;
                        }
                    }
                }

                showNotification(
                    `Wygenerowano ${successCount} kodów. ${errorCount ? `Błędów: ${errorCount}` : ''}`,
                    errorCount ? 'error' : 'success'
                );
            } catch (e) {
                showNotification('Błąd przetwarzania pliku CSV: ' + e.message, 'error');
            }
        }

        // Event Listeners
        document.getElementById('generate-barcode').addEventListener('click', generateBarcode);
        document.getElementById('generate-qr').addEventListener('click', generateQRCode);
        document.getElementById('generate-batch').addEventListener('click', generateBatchCodes);

        // Enter key handling
        document.getElementById('barcode-text').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') generateBarcode();
        });

        document.getElementById('qr-text').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') generateQRCode();
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker zarejestrowany');
                })
                .catch(error => {
                    console.error('Błąd rejestracji Service Workera:', error);
                });
        }

        // Autofocus na pierwszym polu tekstowym
        window.addEventListener('load', () => {
            document.getElementById('barcode-text').focus();
        });

        // Obsługa Drag & Drop dla plików CSV
        const dropZone = document.querySelector('.tab-content[data-tab-content="batch"]');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.classList.add('border-primary');
        }

        function unhighlight(e) {
            dropZone.classList.remove('border-primary');
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length) {
                document.getElementById('csv-file').files = files;
                generateBatchCodes();
            }
        }

        // Zapisywanie ustawień użytkownika
        function saveUserSettings() {
            const settings = {
                format: document.getElementById('barcode-format').value,
                lineWidth: document.getElementById('line-width').value,
                height: document.getElementById('barcode-height').value,
                lineColor: document.getElementById('line-color').value,
                backgroundColor: document.getElementById('background-color').value,
                fontSize: document.getElementById('font-size').value
            };

            localStorage.setItem('userSettings', JSON.stringify(settings));
        }

        // Wczytywanie ustawień użytkownika
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('userSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                Object.entries(settings).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) element.value = value;
                });
            }
        }

        // Event listeners dla zapisywania ustawień
        ['barcode-format', 'line-width', 'barcode-height', 'line-color', 
         'background-color', 'font-size'].forEach(id => {
            document.getElementById(id).addEventListener('change', saveUserSettings);
        });

        // Wczytaj ustawienia przy starcie
        loadUserSettings();
    </script>

    <!-- Service Worker -->
    <script>
        // Kod service workera
        const serviceWorkerContent = `
            self.addEventListener('install', function(event) {
                event.waitUntil(
                    caches.open('barcode-generator-v1').then(function(cache) {
                        return cache.addAll([
                            '/',
                            '/index.html',
                            '/styles.css',
                            'https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js',
                            'https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js',
                            'https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'
                        ]);
                    })
                );
            });

            self.addEventListener('fetch', function(event) {
                event.respondWith(
                    caches.match(event.request).then(function(response) {
                        return response || fetch(event.request);
                    })
                );
            });
        `;

        // Tworzenie Blob z kodem service workera
        const blob = new Blob([serviceWorkerContent], {type: 'text/javascript'});
        const serviceWorkerURL = URL.createObjectURL(blob);

        // Rejestracja service workera
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(serviceWorkerURL)
                .then(registration => {
                    console.log('Service Worker zarejestrowany');
                })
                .catch(error => {
                    console.error('Błąd rejestracji Service Workera:', error);
                });
        }
    </script>
</body>
</html>